# LibEtude 실시간 스트리밍 데모

이 데모 애플리케이션은 LibEtude 엔진의 실시간 스트리밍 음성 합성 기능을 보여줍니다.

## 주요 기능

- **저지연 스트리밍**: 100ms 이하의 목표 지연 시간으로 실시간 음성 합성
- **실시간 파라미터 조정**: 음성 합성 중에도 피치, 속도, 볼륨 등을 실시간으로 조정
- **다중 스레드 처리**: 음성 합성, 오디오 출력, 사용자 제어를 독립적인 스레드로 처리
- **성능 모니터링**: 실시간 지연 시간, 처리량, 버퍼 상태 모니터링
- **크로스 플랫폼 지원**: Windows, macOS, Linux에서 동작

## 아키텍처

### 스레드 구조
- **음성 합성 스레드**: 텍스트를 오디오로 변환하는 백그라운드 처리
- **오디오 출력 스레드**: 생성된 오디오를 실시간으로 재생
- **제어 스레드**: 사용자 입력 처리 및 실시간 파라미터 조정

### 오디오 파이프라인
```
텍스트 입력 → 음성 합성 → 오디오 큐 → 오디오 출력
     ↑              ↑           ↑           ↑
  제어 스레드    합성 스레드   버퍼 관리   출력 스레드
```

## 빌드 방법

```bash
# 프로젝트 루트에서
mkdir build && cd build
cmake ..
make libetude_streaming_demo
```

## 실행 방법

```bash
# 기본 모델로 실행
./libetude_streaming_demo

# 특정 모델 파일로 실행
./libetude_streaming_demo path/to/model.lef
```

## 사용법

### 기본 명령어

- `help` - 도움말 표시
- `start` - 스트리밍 시작
- `stop` - 스트리밍 중지
- `pause` - 스트리밍 일시정지
- `resume` - 스트리밍 재개
- `stats` - 성능 통계 표시
- `params` - 현재 파라미터 표시
- `quit` 또는 `exit` - 프로그램 종료

### 실시간 파라미터 조정

- `pitch <값>` - 피치 스케일 조정 (0.5-2.0)
- `speed <값>` - 속도 스케일 조정 (0.5-2.0)
- `volume <값>` - 볼륨 스케일 조정 (0.0-2.0)
- `quality <값>` - 품질 레벨 설정 (0: 최고 품질, 1: 균형, 2: 최고 속도)

### 텍스트 스트리밍

스트리밍이 활성화된 상태에서 명령어가 아닌 모든 입력은 텍스트로 간주되어 실시간으로 음성으로 변환됩니다.

## 사용 예시

### 기본 스트리밍 시작

```
> start
스트리밍 시작됨

> 안녕하세요, 실시간 스트리밍 데모입니다.
텍스트 스트리밍 요청: "안녕하세요, 실시간 스트리밍 데모입니다."
음성 합성 시작: "안녕하세요, 실시간 스트리밍 데모입니다."
음성 합성 완료 (87.34 ms)
```

### 실시간 파라미터 조정

```
> params
=== 현재 스트리밍 파라미터 ===
피치 스케일: 1.00
속도 스케일: 1.00
볼륨 스케일: 1.00
품질 레벨: 1 (균형)
노이즈 감소: 활성화
에코 제거: 비활성화

> pitch 1.3
피치 스케일을 1.30로 설정했습니다

> speed 0.8
속도 스케일을 0.80로 설정했습니다

> 이제 높은 톤으로 천천히 말합니다.
텍스트 스트리밍 요청: "이제 높은 톤으로 천천히 말합니다."
```

### 성능 모니터링

```
> stats
=== 스트리밍 성능 통계 ===
처리된 청크 수: 15
총 합성 시간: 1234.56 ms
총 오디오 시간: 12345.67 ms
평균 지연 시간: 78.90 ms
최대 지연 시간: 123.45 ms
최소 지연 시간: 45.67 ms
버퍼 언더런: 0
버퍼 오버런: 0
목표 지연 시간: 100 ms
```

### 품질 레벨 조정

```
> quality 0
품질 레벨을 0 (최고 품질)로 설정했습니다

> 최고 품질로 음성을 합성합니다.

> quality 2
품질 레벨을 2 (최고 속도)로 설정했습니다

> 이제 빠른 속도로 처리합니다.
```

## 성능 지표

### 지연 시간 (Latency)
- **목표**: 100ms 이하
- **측정**: 텍스트 입력부터 오디오 출력까지의 시간
- **영향 요소**: 모델 크기, 하드웨어 성능, 품질 설정

### 처리량 (Throughput)
- **측정**: 초당 처리 가능한 텍스트 길이
- **실시간 비율**: 실제 재생 시간 대비 합성 시간의 비율

### 버퍼 관리
- **오디오 큐 크기**: 최대 20개 청크
- **청크 크기**: 512 샘플 (약 23ms @ 22kHz)
- **버퍼 언더런**: 오디오 출력이 합성 속도를 초과할 때 발생
- **버퍼 오버런**: 합성 속도가 오디오 출력을 초과할 때 발생

## 품질 레벨

### 레벨 0: 최고 품질
- **특징**: 최고 음질, 높은 지연 시간
- **용도**: 오프라인 처리, 고품질 요구사항
- **예상 지연**: 150-300ms

### 레벨 1: 균형 (기본값)
- **특징**: 품질과 속도의 균형
- **용도**: 일반적인 실시간 애플리케이션
- **예상 지연**: 80-150ms

### 레벨 2: 최고 속도
- **특징**: 최저 지연 시간, 품질 절충
- **용도**: 실시간 대화, 게임
- **예상 지연**: 50-100ms

## 플랫폼별 특징

### Windows
- **오디오 백엔드**: DirectSound, WASAPI
- **스레드 우선순위**: 실시간 우선순위 지원
- **특별 요구사항**: Windows 7 이상

### macOS
- **오디오 백엔드**: Core Audio, AudioUnit
- **저지연 모드**: Core Audio의 저지연 모드 활용
- **특별 요구사항**: macOS 10.12 이상

### Linux
- **오디오 백엔드**: ALSA, PulseAudio
- **실시간 스케줄링**: RT 커널 지원
- **특별 요구사항**: libasound-dev, libpulse-dev

## 문제 해결

### 높은 지연 시간
1. 품질 레벨을 낮춤 (`quality 2`)
2. 시스템 리소스 사용량 확인
3. 다른 오디오 애플리케이션 종료
4. 오디오 드라이버 업데이트

### 버퍼 언더런
1. 오디오 버퍼 크기 증가
2. CPU 사용률 확인
3. 백그라운드 프로세스 최소화

### 버퍼 오버런
1. 텍스트 입력 속도 조절
2. 메모리 사용량 확인
3. 오디오 큐 크기 조정

### 오디오 출력 문제
1. 오디오 디바이스 연결 확인
2. 시스템 볼륨 설정 확인
3. 오디오 드라이버 재시작

## 개발자 정보

### 디버그 모드
디버그 빌드에서는 추가적인 로그 정보가 출력됩니다:
- 스레드 생성/종료 로그
- 오디오 청크 처리 상세 정보
- 메모리 할당/해제 추적
- 성능 프로파일링 상세 데이터

### 확장 가능성
이 데모는 다음과 같은 확장이 가능합니다:
- 네트워크 스트리밍 지원
- 다중 화자 실시간 전환
- 실시간 음성 효과 적용
- WebRTC 통합
- 음성 인식과의 연동

## 라이선스

이 데모는 LibEtude 프로젝트의 일부로 제공됩니다.